#!/usr/bin/env bash

set -e

if [ "${TRAVIS_PULL_REQUEST_BRANCH:-$TRAVIS_BRANCH}" != "master" ] && [ "$TRAVIS_RUST_VERSION" == "nightly" ]; then
    # Bench variable
    cargo bench > benches-variable;
    # Bench master
    git fetch origin master;
    git checkout -b master FETCH_HEAD;
    cargo bench > benches-control;
    cargo install cargo-benchcmp --force;
    cargo benchcmp benches-control benches-variable;
fi
